# Database Table Structure with Fields

## 1. USERS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| user_id | BIGSERIAL | PRIMARY KEY | Unique user identifier |
| username | VARCHAR(255) | UNIQUE, NOT NULL | Login username |
| password | VARCHAR(255) | NOT NULL | Encrypted password |
| name | VARCHAR(255) | NOT NULL | User full name |
| email | VARCHAR(255) | NOT NULL | User email address |
| mobile_number | VARCHAR(20) | NOT NULL | User phone number |
| role | VARCHAR(50) | CHECK (SUPER_ADMIN, ADMIN, EDITOR, EXAMINEE) | User role type |
| status | VARCHAR(50) | CHECK (ACTIVE, BANNED) | Account status |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Account creation time |
| updated_at | TIMESTAMP | | Last update time |
| last_login | TIMESTAMP | | Last login timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| exams | user | List<Exams> | All exams created by this user |
| userAnswers | user | List<UserAnswers> | All answers submitted by user |
| results | user | List<Results> | All exam results of user |
| sentMessages | senderId | List<Messages> | All messages sent by user |
| receivedMessages | recipientId | List<Messages> | All messages received by user |
| userPackages | user | List<UserPackages> | All packages accessed by user |
| createdPackages | createdBy | List<Packages> | All packages created by user |
| createdQuestions | createdBy | List<Questions> | All questions created by user |
| adminLogs | admin | List<AdminLogs> | All admin actions by this user |

---

## 2. PACKAGES Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| package_id | BIGSERIAL | PRIMARY KEY | Unique package identifier |
| package_name | VARCHAR(255) | NOT NULL | Exam package name |
| start_time | TIMESTAMP | NOT NULL | Exam start date/time |
| end_time | TIMESTAMP | NOT NULL | Exam end date/time |
| duration_minutes | INTEGER | NOT NULL | Exam duration in minutes |
| per_page_questions | INTEGER | NOT NULL | Questions per page |
| each_question_mark | DOUBLE PRECISION | NOT NULL | Marks per question |
| negative_mark | DOUBLE PRECISION | NOT NULL | Negative marking value |
| pass_mark | INTEGER | NOT NULL | Passing marks |
| instant_result | BOOLEAN | NOT NULL | Show result immediately |
| details_result | BOOLEAN | NOT NULL | Show detailed results |
| merit_position | BOOLEAN | NOT NULL | Show merit position |
| free_exam | BOOLEAN | NOT NULL | Is exam free |
| total_examinee | INTEGER | NOT NULL | Total examinees allowed |
| max_concurrent_examinee | INTEGER | NOT NULL | Max concurrent users |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |
| created_by | BIGINT | FOREIGN KEY (users) | Creator user ID |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| categories | examPackage | List<Categories> | All categories in this package |
| exams | examPackage | List<Exams> | All exam instances for this package |
| questions | examPackage | List<Questions> | All questions in this package |
| instructions | examPackage | List<Instructions> | All instructions for this package |
| userPackages | examPackage | List<UserPackages> | All user accesses to this package |
| results | examPackage | List<Results> | All results of this package |
| analysis | examPackage | Analysis | Analysis data for this package |

---

## 3. CATEGORIES Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| category_id | BIGSERIAL | PRIMARY KEY | Unique category identifier |
| category_name | VARCHAR(255) | NOT NULL | Category name |
| total_questions | INTEGER | NOT NULL | Total questions in category |
| selected_questions | INTEGER | NOT NULL | Questions to be selected |
| package_id | BIGINT | FOREIGN KEY (packages) | Parent package |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| questions | category | List<Questions> | All questions in this category |
| exams | category | List<Exams> | All exam instances for this category |

---

## 4. QUESTIONS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| question_id | BIGSERIAL | PRIMARY KEY | Unique question identifier |
| question_text | TEXT | NOT NULL | Question content |
| question_image | VARCHAR(500) | | Question image URL |
| marks | DOUBLE PRECISION | NOT NULL | Question marks |
| negative_mark | DOUBLE PRECISION | NOT NULL | Negative marking |
| shuffle_status | BOOLEAN | NOT NULL | Shuffle options |
| category_id | BIGINT | FOREIGN KEY (categories) | Category reference |
| package_id | BIGINT | FOREIGN KEY (packages) | Package reference |
| created_by | BIGINT | FOREIGN KEY (users) | Creator user ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| options | question | List<QuestionOptions> | All option choices for this question |
| userAnswers | question | List<UserAnswers> | All user answers to this question |

---

## 5. QUESTION_OPTIONS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| option_id | BIGSERIAL | PRIMARY KEY | Unique option identifier |
| option_text | TEXT | NOT NULL | Option content |
| option_image | VARCHAR(500) | | Option image URL |
| is_correct | BOOLEAN | NOT NULL | Is this correct answer |
| option_order | INTEGER | NOT NULL | Option display order |
| question_id | BIGINT | FOREIGN KEY (questions) | Parent question |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| userAnswers | option | List<UserAnswers> | All user answers selecting this option |

---

## 6. QUESTION_OPTIONS_COLLECTION Table (ElementCollection)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| question_id | BIGINT | PRIMARY KEY, FOREIGN KEY (questions) | Question reference |
| option_id | BIGINT | | Option ID |
| option_text | TEXT | | Option text |
| option_image | VARCHAR(500) | | Option image URL |
| is_correct | BOOLEAN | | Is correct flag |
| option_order | INTEGER | PRIMARY KEY | Display order |

---

## 7. QUESTION_CORRECT_ANSWERS Table (ElementCollection)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| question_id | BIGINT | PRIMARY KEY, FOREIGN KEY (questions) | Question reference |
| option_id | BIGINT | PRIMARY KEY | Correct answer option ID |

---

## 8. EXAMS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| exam_id | BIGSERIAL | PRIMARY KEY | Unique exam instance ID |
| exam_name | VARCHAR(255) | NOT NULL | Exam name |
| start_time | TIMESTAMP | NOT NULL | When exam started |
| end_time | TIMESTAMP | NOT NULL | When exam ends |
| duration_seconds | BIGINT | NOT NULL | Exam duration in seconds |
| status | VARCHAR(50) | CHECK (IN_PROGRESS, SUBMITTED, DISCONNECTED) | Exam status |
| auto_submitted | BOOLEAN | NOT NULL | Auto-submitted flag |
| package_id | BIGINT | FOREIGN KEY (packages) | Exam package |
| category_id | BIGINT | FOREIGN KEY (categories) | Exam category |
| user_id | BIGINT | FOREIGN KEY (users) | Examinee user ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| userAnswers | exam | List<UserAnswers> | All answers submitted in this exam |
| notifications | exam | List<Notifications> | All notifications related to this exam |

### One-to-One Relationships
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| result | exam | Results | Result of this exam |
| reExam | exam | ReExams | Re-exam request for this exam |

---

## 9. USER_ANSWERS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| answer_id | BIGSERIAL | PRIMARY KEY | Unique answer identifier |
| is_correct | BOOLEAN | NOT NULL | Is answer correct |
| marks_obtained | DOUBLE PRECISION | NOT NULL | Marks awarded |
| answered_at | TIMESTAMP | NOT NULL | Answer submission time |
| updated_at | TIMESTAMP | | Update timestamp |
| exam_id | BIGINT | FOREIGN KEY (exams) | Exam reference |
| user_id | BIGINT | FOREIGN KEY (users) | User reference |
| question_id | BIGINT | FOREIGN KEY (questions) | Question reference |
| selected_option_id | BIGINT | FOREIGN KEY (question_options) | Selected option |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| (None) | | | User answers are leaf nodes |

---

## 10. USER_SUBMITTED_OPTIONS Table (ElementCollection)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| answer_id | BIGINT | PRIMARY KEY, FOREIGN KEY (user_answers) | Answer reference |
| option_id | BIGINT | PRIMARY KEY | Submitted option ID |

---

## 11. USER_SELECTED_OPTION_TEXTS Table (ElementCollection)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| answer_id | BIGINT | PRIMARY KEY, FOREIGN KEY (user_answers) | Answer reference |
| option_text | VARCHAR(500) | PRIMARY KEY | Selected option text |

---

## 12. USER_ANSWER_DETAILS Table (ElementCollection)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| answer_id | BIGINT | PRIMARY KEY, FOREIGN KEY (user_answers) | Answer reference |
| answer_text | TEXT | | User's written answer |
| submitted_at | VARCHAR(255) | | Submission timestamp |
| is_reviewed | BOOLEAN | | Is reviewed by admin |
| review_notes | TEXT | | Admin's review notes |

---

## 13. RESULTS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| result_id | BIGSERIAL | PRIMARY KEY | Unique result identifier |
| total_questions | INTEGER | NOT NULL | Total questions attempted |
| right_answers | INTEGER | NOT NULL | Number of correct answers |
| wrong_answers | INTEGER | NOT NULL | Number of wrong answers |
| negative_mark | DOUBLE PRECISION | NOT NULL | Total negative marks |
| obtained_marks | DOUBLE PRECISION | NOT NULL | Final marks obtained |
| percentage | DOUBLE PRECISION | NOT NULL | Percentage score |
| time_spent_seconds | BIGINT | NOT NULL | Time taken in seconds |
| merit_position | INTEGER | NOT NULL | Rank/position |
| status | VARCHAR(50) | CHECK (PASSED, FAILED) | Pass/fail status |
| result_published | BOOLEAN | NOT NULL | Is result published |
| published_at | TIMESTAMP | | Publication timestamp |
| exam_id | BIGINT | FOREIGN KEY (exams), UNIQUE | Exam reference |
| user_id | BIGINT | FOREIGN KEY (users) | User reference |
| package_id | BIGINT | FOREIGN KEY (packages) | Package reference |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

---

## 14. INSTRUCTIONS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| instruction_id | BIGSERIAL | PRIMARY KEY | Unique instruction ID |
| instruction_text | TEXT | NOT NULL | Instruction content |
| formatting_enabled | BOOLEAN | NOT NULL | Allow text formatting |
| package_id | BIGINT | FOREIGN KEY (packages) | Package reference |
| created_by | BIGINT | FOREIGN KEY (users) | Creator user ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

---

## 15. MESSAGES Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| message_id | BIGSERIAL | PRIMARY KEY | Unique message identifier |
| subject | VARCHAR(255) | NOT NULL | Message subject |
| message_text | TEXT | NOT NULL | Message content |
| message_type | VARCHAR(50) | CHECK (INQUIRY, SUPPORT) | Message type |
| status | VARCHAR(50) | CHECK (SENT, READ) | Read status |
| sender_id | BIGINT | FOREIGN KEY (users) | Sender user ID |
| recipient_id | BIGINT | FOREIGN KEY (users) | Recipient user ID |
| reply_id | BIGINT | FOREIGN KEY (messages) | Reply to message ID |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| read_at | TIMESTAMP | | Read timestamp |

### One-to-Many Relationships (Inverse side - Collection)
| Relationship | Mapped By | Type | Description |
|--------------|-----------|------|-------------|
| replies | replyId | List<Messages> | All replies to this message |

---

## 16. NOTIFICATIONS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| notification_id | BIGSERIAL | PRIMARY KEY | Unique notification ID |
| type | VARCHAR(50) | CHECK (EXAM_ALERT, RESULT_READY, MESSAGE) | Notification type |
| title | VARCHAR(255) | NOT NULL | Notification title |
| description | TEXT | NOT NULL | Notification content |
| is_read | BOOLEAN | NOT NULL | Read status |
| user_id | BIGINT | FOREIGN KEY (users) | User reference |
| exam_id | BIGINT | FOREIGN KEY (exams) | Exam reference (optional) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Creation timestamp |
| read_at | TIMESTAMP | | Read timestamp |

### Many-to-One Relationships (Owning side - Foreign Keys)
| Relationship | Maps To | Type | Description |
|--------------|---------|------|-------------|
| user | user_id | User | User receiving notification |
| exam | exam_id | Exams | Associated exam |

---

## 17. ADMIN_LOGS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| log_id | BIGSERIAL | PRIMARY KEY | Unique log identifier |
| action | VARCHAR(50) | CHECK (CREATE, EDIT, DELETE, BAN_USER, RE_EXAM) | Action type |
| entity_type | VARCHAR(50) | CHECK (USER, PACKAGE, QUESTION, EXAM) | Entity type |
| entity_id | BIGINT | NOT NULL | Entity ID affected |
| details | TEXT | | Action details |
| admin_id | BIGINT | FOREIGN KEY (users) | Admin user ID |
| ip_address | VARCHAR(50) | NOT NULL | Admin's IP address |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Action timestamp |

### Many-to-One Relationships (Owning side - Foreign Keys)
| Relationship | Maps To | Type | Description |
|--------------|---------|------|-------------|
| admin | admin_id | User | Admin who performed action |

---

## 18. RE_EXAMS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| re_exam_id | BIGSERIAL | PRIMARY KEY | Unique re-exam identifier |
| reason | TEXT | NOT NULL | Reason for re-exam |
| exam_id | BIGINT | FOREIGN KEY (exams), UNIQUE | Original exam |
| user_id | BIGINT | FOREIGN KEY (users) | Examinee user ID |
| package_id | BIGINT | FOREIGN KEY (packages) | Exam package |
| approved_by | BIGINT | FOREIGN KEY (users) | Approver user ID |
| new_exam_id | BIGINT | FOREIGN KEY (exams) | New exam instance ID |
| approved_at | TIMESTAMP | | Approval timestamp |
| created_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Request timestamp |
| updated_at | TIMESTAMP | | Update timestamp |

### Many-to-One Relationships (Owning side - Foreign Keys)
| Relationship | Maps To | Type | Description |
|--------------|---------|------|-------------|
| exam | exam_id | Exams | Original exam being challenged |
| user | user_id | User | User requesting re-exam |
| examPackage | package_id | Packages | Package of the exam |
| approvedBy | approved_by | User | Admin who approved re-exam |
| newExam | new_exam_id | Exams | New exam instance created |

### One-to-One Relationships
| Relationship | Inverse | Type | Description |
|--------------|---------|------|-------------|
| (inverse) | reExam | ReExams | One exam can have one re-exam request |

---

## 19. ANALYSIS Table
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| analysis_id | BIGSERIAL | PRIMARY KEY | Unique analysis ID |
| total_examinee | INTEGER | NOT NULL | Total examinees registered |
| participants | INTEGER | NOT NULL | Examinees who participated |
| percentage_of_participants | DOUBLE PRECISION | NOT NULL | Participation percentage |
| remaining | INTEGER | NOT NULL | Remaining examinees |
| percentage_of_remaining | DOUBLE PRECISION | NOT NULL | Remaining percentage |
| passed | INTEGER | NOT NULL | Number passed |
| percentage_of_passed | DOUBLE PRECISION | NOT NULL | Pass percentage |
| failed | INTEGER | NOT NULL | Number failed |
| percentage_of_failed | DOUBLE PRECISION | NOT NULL | Fail percentage |
| average_marks | DOUBLE PRECISION | NOT NULL | Average marks |
| above80 | INTEGER | NOT NULL | Count >80% |
| above70 | INTEGER | NOT NULL | Count >70% |
| above60 | INTEGER | NOT NULL | Count >60% |
| above50 | INTEGER | NOT NULL | Count >50% |
| below50 | INTEGER | NOT NULL | Count <50% |
| below40 | INTEGER | NOT NULL | Count <40% |
| below20 | INTEGER | NOT NULL | Count <20% |
| below10 | INTEGER | NOT NULL | Count <10% |
| package_id | BIGINT | FOREIGN KEY (packages), UNIQUE | Package reference |
| pdf_path | VARCHAR(500) | | Analysis PDF path |
| generated_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Generation timestamp |

---

## 20. USER_PACKAGES Table (Junction Table)
| Field | Type | Constraints | Description |
|-------|------|-------------|-------------|
| user_package_id | BIGSERIAL | PRIMARY KEY | Unique relationship ID |
| access_type | VARCHAR(50) | CHECK (FREE, PAID) | Access type |
| user_id | BIGINT | FOREIGN KEY (users) | User reference |
| package_id | BIGINT | FOREIGN KEY (packages) | Package reference |
| assigned_at | TIMESTAMP | NOT NULL, DEFAULT NOW() | Assignment timestamp |
| expires_at | TIMESTAMP | | Expiration timestamp |
| UNIQUE | (user_id, package_id) | | One entry per user-package |

---

## Summary of All Relationships

### One-to-Many Relationships (Parent → Child Collection)

| Parent Table | Parent PK | Child Table | Foreign Key | Collection Field |
|--------------|-----------|-------------|-------------|------------------|
| users | user_id | exams | user_id | exams |
| users | user_id | user_answers | user_id | userAnswers |
| users | user_id | results | user_id | results |
| users | user_id | messages | sender_id | sentMessages |
| users | user_id | messages | recipient_id | receivedMessages |
| users | user_id | user_packages | user_id | userPackages |
| users | user_id | packages | created_by | createdPackages |
| users | user_id | questions | created_by | createdQuestions |
| users | user_id | admin_logs | admin_id | adminLogs |
| packages | package_id | categories | package_id | categories |
| packages | package_id | exams | package_id | exams |
| packages | package_id | questions | package_id | questions |
| packages | package_id | instructions | package_id | instructions |
| packages | package_id | user_packages | package_id | userPackages |
| packages | package_id | results | package_id | results |
| categories | category_id | questions | category_id | questions |
| categories | category_id | exams | category_id | exams |
| questions | question_id | question_options | question_id | options |
| questions | question_id | user_answers | question_id | userAnswers |
| question_options | option_id | user_answers | selected_option_id | userAnswers |
| exams | exam_id | user_answers | exam_id | userAnswers |
| exams | exam_id | notifications | exam_id | notifications |
| messages | message_id | messages | reply_id | replies |

### One-to-One Relationships (Parent ↔ Child Single)

| Parent Table | Parent PK | Child Table | Foreign Key | Relationship Field |
|--------------|-----------|-------------|-------------|-------------------|
| exams | exam_id | results | exam_id | result |
| exams | exam_id | re_exams | exam_id | reExam |
| packages | package_id | analysis | package_id | analysis |

### Many-to-One Relationships (Child → Parent Reference)

| Child Table | Foreign Key | Parent Table | Parent PK | Reference Field |
|-------------|-------------|--------------|-----------|-----------------|
| packages | created_by | users | user_id | createdBy |
| categories | package_id | packages | package_id | examPackage |
| questions | category_id | categories | category_id | category |
| questions | package_id | packages | package_id | examPackage |
| questions | created_by | users | user_id | createdBy |
| question_options | question_id | questions | question_id | question |
| exams | package_id | packages | package_id | examPackage |
| exams | category_id | categories | category_id | category |
| exams | user_id | users | user_id | user |
| user_answers | exam_id | exams | exam_id | exam |
| user_answers | user_id | users | user_id | user |
| user_answers | question_id | questions | question_id | question |
| user_answers | selected_option_id | question_options | option_id | option |
| results | exam_id | exams | exam_id | exam |
| results | user_id | users | user_id | user |
| results | package_id | packages | package_id | examPackage |
| instructions | package_id | packages | package_id | examPackage |
| instructions | created_by | users | user_id | createdBy |
| messages | sender_id | users | user_id | senderId |
| messages | recipient_id | users | user_id | recipientId |
| messages | reply_id | messages | message_id | replyId |
| notifications | user_id | users | user_id | user |
| notifications | exam_id | exams | exam_id | exam |
| admin_logs | admin_id | users | user_id | admin |
| re_exams | exam_id | exams | exam_id | exam |
| re_exams | user_id | users | user_id | user |
| re_exams | package_id | packages | package_id | examPackage |
| re_exams | approved_by | users | user_id | approvedBy |
| re_exams | new_exam_id | exams | exam_id | newExam |
| analysis | package_id | packages | package_id | examPackage |
| user_packages | user_id | users | user_id | user |
| user_packages | package_id | packages | package_id | examPackage |

```sql
-- Performance indexes
CREATE INDEX idx_users_username ON users(username);
CREATE INDEX idx_users_role ON users(role);
CREATE INDEX idx_packages_start_time ON packages(start_time);
CREATE INDEX idx_exams_user_id ON exams(user_id);
CREATE INDEX idx_exams_status ON exams(status);
CREATE INDEX idx_results_user_id ON results(user_id);
CREATE INDEX idx_results_merit_position ON results(merit_position);
CREATE INDEX idx_questions_category_id ON questions(category_id);
CREATE INDEX idx_admin_logs_created_at ON admin_logs(created_at);
CREATE INDEX idx_messages_recipient_id ON messages(recipient_id);
```

---

## Foreign Key Relationships

- **users** ← (created_by) ← packages, questions, instructions
- **packages** ← categories, questions, exams, results
- **categories** ← questions, exams
- **questions** ← question_options, user_answers
- **exams** ← user_answers, results, re_exams, notifications
- **users** ← exams, user_answers, results, messages, notifications, admin_logs
