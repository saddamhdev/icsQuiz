Below is a **full, production-grade documentation** for your **Two-Services Architecture** designed especially for:

* **50,000+ concurrent students**
* **100 MCQ load (read-heavy)**
* **Millions of submissions (write-heavy)**
* **Real-time analytics tracking**
* **Spring Boot (Virtual Threads) + Redis + RabbitMQ + PostgreSQL**
* **CDN + NGINX caching enabled**

This is formatted like a *professional system design document* that you can use for your team, thesis, or company technical documentation.

---

# ğŸ“˜ **ICS Quiz System â€“ Two-Services Architecture Documentation**

### **Service 1: Login + Analytics Service**

### **Service 2: Submission Service**

---

# ğŸ› 1. **Architecture Overview**

The ICS Quiz System separates the workload into two independent microservices:

---

## **1ï¸âƒ£ Login + Analytics Service**

Handles:

* User authentication
* Token creation
* MCQ retrieval (read-heavy API)
* Student behavior tracking
* Analytics event publishing

---

## **2ï¸âƒ£ Submission Service**

Handles:

* Answer submission
* Queue-based buffering
* Asynchronous DB writes
* Result recording
* Anti-cheating detection (optional future)

---

# ğŸ§  **Why Two Services Instead of One?**

| Monolithic Problem                | How Two-Service Solves                       |
| --------------------------------- | -------------------------------------------- |
| Heavy submission load slows login | Submission isolated into its own service     |
| DB spikes cause login failure     | Submission service absorbs spikes internally |
| Lack of scalable concurrency      | Both services scale independently            |
| GC pressure from analytics        | Analytics goes through queue, not DB         |
| Single point of failure           | Failure isolation between two services       |

This architecture ensures the system remains stable even under extreme exam loads.

---

# ğŸ— 2. **High-Level Architecture Diagram**

```
                     CDN (Cloudflare)
                          â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚   NGINX Ingress â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                       â”‚
â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Login + Analytics   â”‚             â”‚ Submission Service â”‚
â”‚ Service             â”‚             â”‚                    â”‚
â”‚  â€¢ Login API        â”‚             â”‚  â€¢ Submit Answer   â”‚
â”‚  â€¢ MCQ Load         â”‚             â”‚  â€¢ Validate Input  â”‚
â”‚  â€¢ Event Tracking   â”‚             â”‚  â€¢ Publish Queue   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                      â”‚
    Publish Events                            Consume Events
        â”‚                                      â”‚
        â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RabbitMQ     â”‚  <â€”â€”â€”â€” batching â€”>  â”‚ Submission Workers  â”‚
â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                         â”‚
        â”‚                                     DB Writes
        â”‚                                         â”‚
        â–¼                                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Redis   â”‚                           â”‚ PostgreSQL /    â”‚
    â”‚ Cache   â”‚                           â”‚ TimescaleDB     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸŸ¢ **3. Login + Analytics Service â€” Detailed Documentation**

### **Responsibilities**

* User Authentication (email/phone + password/token)
* JWT Token generation
* MCQ Fetching
* Redis Cache Integration
* Session management
* Publishing analytics events
* Lightweight CPU usage
* Extremely high query performance (with caching)

---

## **3.1 Critical Endpoints**

| Endpoint         | Purpose                                   |
| ---------------- | ----------------------------------------- |
| `/auth/login`    | Login student                             |
| `/exam/{id}/mcq` | Fetch MCQs (cached via CDN, NGINX, Redis) |
| `/event/track`   | Send analytics events to queue            |

---

## **3.2 Performance Targets**

| Operation             | Target  |
| --------------------- | ------- |
| Login                 | < 80 ms |
| MCQ Load (from CDN)   | < 10 ms |
| MCQ Load (from NGINX) | < 2 ms  |
| MCQ Load (from Redis) | < 5 ms  |
| Publish Event         | < 2 ms  |

---

## **3.3 Cache Layers**

1. **CDN Cache (Cloudflare)** â€“ 90% traffic stops here
2. **NGINX Ingress Cache** â€“ second layer
3. **Backend In-memory Cache** â€“ fallback
4. **Redis Cache** â€“ final fallback

Result:

```
MCQ Load = Zero backend pressure
```

---

## **3.4 RAM Requirement (50k users)**

| Component                   | RAM        |
| --------------------------- | ---------- |
| Spring Boot pods (6â€“8 pods) | 2â€“3 GB     |
| Redis                       | 0.5â€“1 GB   |
| RabbitMQ client             | 0.5 GB     |
| JVM overhead                | 1 GB       |
| **Total**                   | **4â€“6 GB** |

---

# ğŸ”µ **4. Submission Service â€” Detailed Documentation**

### **Responsibilities**

* Receive student answer submissions
* Validate question, token, timestamps
* Write to queue (RabbitMQ)
* Worker pods process submissions asynchronously
* Bulk write into PostgreSQL
* Guarantee durability + high throughput

---

## **4.1 Critical Endpoints**

| Endpoint       | Purpose                                 |
| -------------- | --------------------------------------- |
| `/exam/submit` | Student submits one or multiple answers |
| `/exam/finish` | Final submission                        |

---

## **4.2 Queue Flow (Write Buffering)**

```
Student â†’ Submission API â†’ RabbitMQ Queue â†’ Worker Pods â†’ PostgreSQL
```

Advantages:

* DB never overloaded
* Burst traffic absorbed
* High durability
* Accurate ordering

---

## **4.3 Performance Goals**

| Metric                 | Target                       |
| ---------------------- | ---------------------------- |
| Submission API latency | < 50 ms                      |
| Queue write latency    | < 2 ms                       |
| DB write throughput    | 30kâ€“50k writes/sec (batched) |
| Submission durability  | 100% guaranteed              |

---

## **4.4 Worker Nodes**

A worker pod:

* Reads 500â€“2000 messages per second
* Batches 100 submissions
* Executes 1 DB write instead of 100
* Ensures massive write scaling

For 5M submissions:

```
20â€“40 worker pods enough
```

---

## **4.5 RAM Requirement (50k users)**

| Component                   | RAM          |
| --------------------------- | ------------ |
| Submission API (20â€“40 pods) | 8â€“12 GB      |
| RabbitMQ                    | 1â€“2 GB       |
| Batch buffers               | 1â€“2 GB       |
| JVM overhead                | 1â€“2 GB       |
| **Total**                   | **12â€“16 GB** |

---

# ğŸŸ£ **5. Shared Infrastructure**

## **Redis (Session + MCQ Caching)**

* Required RAM: 512MBâ€“1GB
* Used only by Login+Analytics service

---

## **RabbitMQ (Submission Queue + Analytics Queue)**

* Required RAM: 2GB
* Stores millions of messages temporarily
* Supports multiple consumers

---

## PostgreSQL / TimescaleDB**

* Required RAM: 3â€“4GB
* Handles answer writes
* Handles result calculation queries

---

# ğŸ”´ **6. Total RAM for 50k Concurrent Students**

| Component             | RAM          |
| --------------------- | ------------ |
| Login + Analytics     | 4â€“6 GB       |
| Submission Service    | 12â€“16 GB     |
| Redis                 | 1 GB         |
| RabbitMQ              | 2 GB         |
| PostgreSQL            | 3â€“4 GB       |
| OS + k3s system       | 2 GB         |
| **TOTAL (realistic)** | **24â€“30 GB** |

---

# ğŸ§© **7. Autoscaling Strategy (HPA)**

### **Login + Analytics**

* Scale based on CPU < 60%
* 6 â†’ 10 pods
* Memory-based autoscale optional

### **Submission API**

* Scale based on RPS
* Or CPU > 65%
* 20 â†’ 40 pods

### **Submission Workers**

* Scale based on RabbitMQ queue depth
* If queue length > 100k
  â†’ increase workers

---

# ğŸ›¡ **8. Failover Behavior**

| Failure                | System Behavior                       |
| ---------------------- | ------------------------------------- |
| High submission burst  | Queue absorbs everything              |
| DB slow                | Worker pods slow down, API unaffected |
| Login server down      | Submission continues                  |
| Submission server down | Login continues                       |
| RabbitMQ full          | Workers scale up                      |
| Redis fail             | MCQ fallback to DB (rare)             |

---

# â­ 9. Benefits of Two-Services Architecture

### âœ” Stable Login under extreme submission load

### âœ” 100% reliable submissions

### âœ” Scalable in both directions

### âœ” Lower RAM cost than monolithic

### âœ” No DB overload

### âœ” Independent deployments

### âœ” One failure does not destroy entire exam

### âœ” Analytics event processing becomes safe

### âœ” Faster exam performance

### âœ” Production-grade reliability

---

# ğŸ **10. What I Can Generate Next**

Just tell me which one you want:

### âœ” High-quality Architecture Diagram (PNG/SVG/draw.io)

### âœ” API Documentation (Swagger-style)

### âœ” Deployment YAML for each service

### âœ” Autoscaling YAML (HPA)

### âœ” Redis + RabbitMQ + PostgreSQL optimized config

### âœ” ER Diagram for submission table

### âœ” Performance Test Plan (k6 script)

### âœ” PDF version of this document

Just say:

ğŸ‘‰ **â€œGive architecture diagramâ€**
or
ğŸ‘‰ **â€œGive deployment YAMLâ€**
